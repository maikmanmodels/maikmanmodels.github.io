<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Maikman Models</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #111;
      color: #eee;
    }

    header {
      background: #1c1c1c;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1, h2, h3 {
      margin: 0 0 10px 0;
    }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }

    button.secondary {
      background: #444;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
    }

    #loginScreen, #appScreen {
      display: none;
      padding: 20px;
      max-width: 420px;
      margin: auto;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 20px;
    }

    .card {
      background: #1e1e1e;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,.4);
    }

    .card b {
      font-size: 16px;
      display: block;
      margin-bottom: 6px;
    }

    .actions {
      margin-top: 10px;
      display: flex;
      gap: 6px;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h2>Maikman Models</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Contrase침a">
  <button id="loginBtn">Entrar</button>
  <p id="loginError" style="color:#f87171"></p>
</div>

<!-- APP -->
<div id="appScreen">
  <header>
    <h3>Maikman Models</h3>
    <button id="logoutBtn" class="secondary">Salir</button>
  </header>

  <h3>A침adir modelo</h3>

  <input id="codigo" placeholder="C칩digo">
  <input id="fabricante" placeholder="Fabricante">
  <input id="modelo" placeholder="Modelo">

  <button id="addBtn">Guardar modelo</button>

  <div class="grid" id="cards"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  /* 游댠 FIREBASE REAL (TUS DATOS) 游댠 */
  const firebaseConfig = {
    apiKey: "AIzaSyAtWLxQfVqsEt8fLZkGRN-3zSHuzKMUTk8",
    authDomain: "maikmanmodelsstock.firebaseapp.com",
    projectId: "maikmanmodelsstock",
    storageBucket: "maikmanmodelsstock.firebasestorage.app",
    messagingSenderId: "871520809912",
    appId: "1:871520809912:web:4042f15ef200832a95d54d"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const loginScreen = document.getElementById("loginScreen");
  const appScreen = document.getElementById("appScreen");
  const cardsDiv = document.getElementById("cards");

  /* ======================
     AUTH
  ====================== */
  onAuthStateChanged(auth, user => {
    if (user) {
      loginScreen.style.display = "none";
      appScreen.style.display = "block";
      renderCards();
    } else {
      appScreen.style.display = "none";
      loginScreen.style.display = "block";
    }
  });

  document.getElementById("loginBtn").onclick = () => {
    signInWithEmailAndPassword(
      auth,
      email.value,
      password.value
    ).catch(err => {
      loginError.textContent = err.message;
    });
  };

  document.getElementById("logoutBtn").onclick = () => {
    signOut(auth);
  };

  /* ======================
     MODELOS (localStorage)
  ====================== */
  function getModels() {
    return JSON.parse(localStorage.getItem("maikman_models") || "[]");
  }

  function saveModels(models) {
    localStorage.setItem("maikman_models", JSON.stringify(models));
  }

  function renderCards() {
    cardsDiv.innerHTML = "";
    getModels().forEach((m, i) => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <b>${m.modelo}</b>
        C칩digo: ${m.codigo}<br>
        Fabricante: ${m.fabricante}
        <div class="actions">
          <button class="secondary" onclick="deleteModel(${i})">Borrar</button>
        </div>
      `;
      cardsDiv.appendChild(div);
    });
  }

  window.deleteModel = (index) => {
    const models = getModels();
    models.splice(index, 1);
    saveModels(models);
    renderCards();
  };

  document.getElementById("addBtn").onclick = () => {
    const codigo = codigoInput.value || codigo.value;
    const fabricante = fabricanteInput?.value || fabricante.value;
    const modelo = modeloInput?.value || modelo.value;

    if (!codigo || !fabricante || !modelo) return;

    const models = getModels();
    models.push({ codigo, fabricante, modelo });
    saveModels(models);
    renderCards();

    codigoInput.value = "";
    fabricanteInput.value = "";
    modeloInput.value = "";
  };
</script>

</body>
</html>
