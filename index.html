<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Maikman Models – Inventario</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg: #f2f2f2;
  --card: #ffffff;
  --text: #000000;
  --accent: #d32f2f;
}

[data-theme="dark"] {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #ffffff;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  background: var(--card);
  box-shadow: 0 2px 4px rgba(0,0,0,.2);
}

button {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  background: var(--accent);
  color: white;
}

button.secondary {
  background: #555;
}

#grid {
  display: grid;
  gap: 12px;
  padding: 12px;
}

.card {
  background: var(--card);
  padding: 10px;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,.2);
}

.card img {
  width: 100%;
  border-radius: 4px;
}

.pantalla {
  display: none;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: var(--card);
  padding: 20px;
  border-radius: 8px;
  width: 90%;
  max-width: 400px;
}
</style>
</head>

<body>

<header>
  <strong>Maikman Models</strong>
  <div>
    <button onclick="abrirConfig()">⚙️</button>
    <button class="secondary" onclick="salir()">Salir</button>
  </div>
</header>

<!-- PANTALLA LOGIN / INICIO -->
<div id="pantalla-login" class="pantalla">
  <div style="padding:20px">
    <h2>Inventario de Maquetas</h2>
    <button onclick="entrar()">Entrar</button>
  </div>
</div>

<!-- PANTALLA BUSCADOR -->
<div id="pantalla-app" class="pantalla">
  <div style="padding:12px">
    <input id="busqueda" placeholder="Buscar modelo en Scalemates..."
           style="width:70%;padding:6px">
    <button onclick="buscar()">Buscar</button>
  </div>

  <div id="grid"></div>
</div>

<!-- MODAL CONFIGURACIÓN -->
<div id="modalConfig" class="modal">
  <div class="modal-content">
    <h3>Configuración</h3>

    <label>
      Tema:
      <select onchange="cambiarTema(this.value)">
        <option value="light">Claro</option>
        <option value="dark">Oscuro</option>
      </select>
    </label>

    <br><br>

    <label>
      Tarjetas por fila:
      <select onchange="cambiarColumnas(this.value)">
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </label>

    <br><br>

    <button onclick="cerrarConfig()">Cerrar</button>
  </div>
</div>

<script>
/* ---------- ESTADO ---------- */
let columnas = localStorage.getItem("columnas") || 3;
let tema = localStorage.getItem("tema") || "light";

document.documentElement.setAttribute("data-theme", tema);
document.getElementById("grid").style.gridTemplateColumns =
  `repeat(${columnas}, 1fr)`;

/* ---------- NAVEGACIÓN ---------- */
function entrar() {
  document.getElementById("pantalla-login").style.display = "none";
  document.getElementById("pantalla-app").style.display = "block";
}

function salir() {
  document.querySelectorAll(".pantalla").forEach(p => p.style.display = "none");
  document.getElementById("pantalla-login").style.display = "block";
  history.replaceState(null, "", "./");
}

/* ---------- CONFIG ---------- */
function abrirConfig() {
  document.getElementById("modalConfig").style.display = "flex";
}

function cerrarConfig() {
  document.getElementById("modalConfig").style.display = "none";
}

function cambiarTema(valor) {
  document.documentElement.setAttribute("data-theme", valor);
  localStorage.setItem("tema", valor);
}

function cambiarColumnas(valor) {
  columnas = valor;
  document.getElementById("grid").style.gridTemplateColumns =
    `repeat(${valor}, 1fr)`;
  localStorage.setItem("columnas", valor);
}

/* ---------- BÚSQUEDA SCALEMATES ---------- */
async function buscar() {
  const q = document.getElementById("busqueda").value.trim();
  if (!q) return;

  const grid = document.getElementById("grid");
  grid.innerHTML = "Buscando…";

  try {
    const url =
      "https://scalemates-proxy.yotracuentadeinstagram.workers.dev/?query=" +
      encodeURIComponent(q);

    const res = await fetch(url);
    const data = await res.json();

    grid.innerHTML = "";

    if (!data.results || data.results.length === 0) {
      grid.innerHTML = "Sin resultados";
      return;
    }

    data.results.forEach(m => {
      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        <img src="${m.image || 'https://via.placeholder.com/300x200?text=Sin+imagen'}">
        <strong>${m.name || 'Modelo desconocido'}</strong><br>
        Marca: ${m.brand || '-'}<br>
        Escala: ${m.scale || '-'}
      `;

      grid.appendChild(div);
    });

  } catch (e) {
    grid.innerHTML = "Error al buscar";
    console.error(e);
  }
}

/* ---------- INICIO ---------- */
window.onload = () => {
  salir();
};
</script>

</body>
</html>
